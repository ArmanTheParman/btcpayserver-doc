<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reverse proxy to Tor | BTCPay Server</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="stylesheet" href="/styles/btcpayserver-variables.css">
    <meta name="description" content="BTCPay Server Official Documentation">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.5d7f2299.css" as="style"><link rel="preload" href="/assets/js/app.a6efeb8d.js" as="script"><link rel="preload" href="/assets/js/2.3670bf66.js" as="script"><link rel="preload" href="/assets/js/117.9bad4e6d.js" as="script"><link rel="prefetch" href="/assets/js/1.4ae02fbc.js"><link rel="prefetch" href="/assets/js/100.a6a090d0.js"><link rel="prefetch" href="/assets/js/101.48d7fe0b.js"><link rel="prefetch" href="/assets/js/102.edbc4b40.js"><link rel="prefetch" href="/assets/js/103.df3cec0e.js"><link rel="prefetch" href="/assets/js/104.3af12b1c.js"><link rel="prefetch" href="/assets/js/105.67c00517.js"><link rel="prefetch" href="/assets/js/106.2e3b7c36.js"><link rel="prefetch" href="/assets/js/107.baf210cb.js"><link rel="prefetch" href="/assets/js/108.2fb98786.js"><link rel="prefetch" href="/assets/js/109.cd4733ca.js"><link rel="prefetch" href="/assets/js/110.08e4d8ee.js"><link rel="prefetch" href="/assets/js/111.a2bd256a.js"><link rel="prefetch" href="/assets/js/112.4cb55ab9.js"><link rel="prefetch" href="/assets/js/113.94f4ea42.js"><link rel="prefetch" href="/assets/js/114.72397f05.js"><link rel="prefetch" href="/assets/js/115.2c11a7c2.js"><link rel="prefetch" href="/assets/js/116.e7717439.js"><link rel="prefetch" href="/assets/js/118.965b0f5b.js"><link rel="prefetch" href="/assets/js/119.85a10df3.js"><link rel="prefetch" href="/assets/js/12.c2af5bc8.js"><link rel="prefetch" href="/assets/js/120.bab4f8cf.js"><link rel="prefetch" href="/assets/js/121.39edde96.js"><link rel="prefetch" href="/assets/js/122.bc507f9f.js"><link rel="prefetch" href="/assets/js/123.65ed732d.js"><link rel="prefetch" href="/assets/js/124.f07d4ef8.js"><link rel="prefetch" href="/assets/js/125.1f57aba4.js"><link rel="prefetch" href="/assets/js/126.7cb0c5eb.js"><link rel="prefetch" href="/assets/js/127.9fdfb987.js"><link rel="prefetch" href="/assets/js/128.2ed7dcb5.js"><link rel="prefetch" href="/assets/js/129.385cc686.js"><link rel="prefetch" href="/assets/js/13.96cec31e.js"><link rel="prefetch" href="/assets/js/130.5151da8c.js"><link rel="prefetch" href="/assets/js/131.a72975c2.js"><link rel="prefetch" href="/assets/js/132.6bd04635.js"><link rel="prefetch" href="/assets/js/133.664fab5f.js"><link rel="prefetch" href="/assets/js/134.1cbca681.js"><link rel="prefetch" href="/assets/js/135.11326201.js"><link rel="prefetch" href="/assets/js/136.674a7c3b.js"><link rel="prefetch" href="/assets/js/137.9e2b0bd2.js"><link rel="prefetch" href="/assets/js/138.e68e8975.js"><link rel="prefetch" href="/assets/js/139.b17a1bda.js"><link rel="prefetch" href="/assets/js/14.3a41f965.js"><link rel="prefetch" href="/assets/js/140.43e0ada0.js"><link rel="prefetch" href="/assets/js/141.4f4f0efd.js"><link rel="prefetch" href="/assets/js/142.d5397f55.js"><link rel="prefetch" href="/assets/js/143.3f0a3daf.js"><link rel="prefetch" href="/assets/js/144.3d80220b.js"><link rel="prefetch" href="/assets/js/145.efd552dd.js"><link rel="prefetch" href="/assets/js/146.6dcd1f30.js"><link rel="prefetch" href="/assets/js/147.7a62269f.js"><link rel="prefetch" href="/assets/js/148.0e73ab62.js"><link rel="prefetch" href="/assets/js/149.f2c369c9.js"><link rel="prefetch" href="/assets/js/15.455b42b1.js"><link rel="prefetch" href="/assets/js/150.4743378c.js"><link rel="prefetch" href="/assets/js/151.3e57b0d7.js"><link rel="prefetch" href="/assets/js/152.dc85d266.js"><link rel="prefetch" href="/assets/js/153.9cf476c2.js"><link rel="prefetch" href="/assets/js/154.5c479d69.js"><link rel="prefetch" href="/assets/js/155.3f76610d.js"><link rel="prefetch" href="/assets/js/156.0215db3a.js"><link rel="prefetch" href="/assets/js/157.969dc59e.js"><link rel="prefetch" href="/assets/js/158.53efbfce.js"><link rel="prefetch" href="/assets/js/159.e748b753.js"><link rel="prefetch" href="/assets/js/16.f4562109.js"><link rel="prefetch" href="/assets/js/160.3f8e5cf5.js"><link rel="prefetch" href="/assets/js/161.683f44cc.js"><link rel="prefetch" href="/assets/js/162.fd8d8f8b.js"><link rel="prefetch" href="/assets/js/163.7a156b64.js"><link rel="prefetch" href="/assets/js/164.51da5545.js"><link rel="prefetch" href="/assets/js/165.f97ba9fe.js"><link rel="prefetch" href="/assets/js/166.bac6f43d.js"><link rel="prefetch" href="/assets/js/167.1788725b.js"><link rel="prefetch" href="/assets/js/168.cf399eba.js"><link rel="prefetch" href="/assets/js/169.24fbe700.js"><link rel="prefetch" href="/assets/js/17.b1ac8a76.js"><link rel="prefetch" href="/assets/js/18.be0d72e4.js"><link rel="prefetch" href="/assets/js/19.e75652bc.js"><link rel="prefetch" href="/assets/js/20.11ba0743.js"><link rel="prefetch" href="/assets/js/21.729cf125.js"><link rel="prefetch" href="/assets/js/22.f0990b01.js"><link rel="prefetch" href="/assets/js/23.701eb6bf.js"><link rel="prefetch" href="/assets/js/24.e6f7096c.js"><link rel="prefetch" href="/assets/js/25.e5f66856.js"><link rel="prefetch" href="/assets/js/26.754ff1dd.js"><link rel="prefetch" href="/assets/js/27.0f9bb65c.js"><link rel="prefetch" href="/assets/js/28.8a6413ad.js"><link rel="prefetch" href="/assets/js/29.13f78c23.js"><link rel="prefetch" href="/assets/js/3.e7b96e02.js"><link rel="prefetch" href="/assets/js/30.83175d27.js"><link rel="prefetch" href="/assets/js/31.f5631287.js"><link rel="prefetch" href="/assets/js/32.85e70b21.js"><link rel="prefetch" href="/assets/js/33.fb7fc044.js"><link rel="prefetch" href="/assets/js/34.283f7600.js"><link rel="prefetch" href="/assets/js/35.c291d612.js"><link rel="prefetch" href="/assets/js/36.f3d7216d.js"><link rel="prefetch" href="/assets/js/37.b7e728eb.js"><link rel="prefetch" href="/assets/js/38.6cd70179.js"><link rel="prefetch" href="/assets/js/39.612d9495.js"><link rel="prefetch" href="/assets/js/4.ae9ec4e8.js"><link rel="prefetch" href="/assets/js/40.991f2124.js"><link rel="prefetch" href="/assets/js/41.b7651d8a.js"><link rel="prefetch" href="/assets/js/42.80411d32.js"><link rel="prefetch" href="/assets/js/43.1b59571d.js"><link rel="prefetch" href="/assets/js/44.dd2311c3.js"><link rel="prefetch" href="/assets/js/45.3c470392.js"><link rel="prefetch" href="/assets/js/46.be278dd6.js"><link rel="prefetch" href="/assets/js/47.2174348a.js"><link rel="prefetch" href="/assets/js/48.921df9ab.js"><link rel="prefetch" href="/assets/js/49.9e160e5a.js"><link rel="prefetch" href="/assets/js/5.ec07fb10.js"><link rel="prefetch" href="/assets/js/50.4e61de35.js"><link rel="prefetch" href="/assets/js/51.3e2277e7.js"><link rel="prefetch" href="/assets/js/52.b22b9e0c.js"><link rel="prefetch" href="/assets/js/53.f41a19b5.js"><link rel="prefetch" href="/assets/js/54.c7688166.js"><link rel="prefetch" href="/assets/js/55.4f63233f.js"><link rel="prefetch" href="/assets/js/56.2ef89fb5.js"><link rel="prefetch" href="/assets/js/57.51ae8c08.js"><link rel="prefetch" href="/assets/js/58.70bc2588.js"><link rel="prefetch" href="/assets/js/59.d4c3a24f.js"><link rel="prefetch" href="/assets/js/6.04bdb264.js"><link rel="prefetch" href="/assets/js/60.34732982.js"><link rel="prefetch" href="/assets/js/61.2f2a3d30.js"><link rel="prefetch" href="/assets/js/62.a0012c4f.js"><link rel="prefetch" href="/assets/js/63.a0c426d8.js"><link rel="prefetch" href="/assets/js/64.e6503d0d.js"><link rel="prefetch" href="/assets/js/65.fc7cb630.js"><link rel="prefetch" href="/assets/js/66.b8183b5f.js"><link rel="prefetch" href="/assets/js/67.8790a920.js"><link rel="prefetch" href="/assets/js/68.e2dc3e6e.js"><link rel="prefetch" href="/assets/js/69.210cc955.js"><link rel="prefetch" href="/assets/js/7.16399f20.js"><link rel="prefetch" href="/assets/js/70.5a97b5b1.js"><link rel="prefetch" href="/assets/js/71.4c62d8f5.js"><link rel="prefetch" href="/assets/js/72.f20ef58d.js"><link rel="prefetch" href="/assets/js/73.9e00ec3f.js"><link rel="prefetch" href="/assets/js/74.55197e58.js"><link rel="prefetch" href="/assets/js/75.1f727dbd.js"><link rel="prefetch" href="/assets/js/76.a3429877.js"><link rel="prefetch" href="/assets/js/77.6b1d2bf6.js"><link rel="prefetch" href="/assets/js/78.2b569889.js"><link rel="prefetch" href="/assets/js/79.32e6d61c.js"><link rel="prefetch" href="/assets/js/8.ac3ed6a5.js"><link rel="prefetch" href="/assets/js/80.6b2f5411.js"><link rel="prefetch" href="/assets/js/81.f716757f.js"><link rel="prefetch" href="/assets/js/82.fe776dc9.js"><link rel="prefetch" href="/assets/js/83.0aa42b31.js"><link rel="prefetch" href="/assets/js/84.e047721d.js"><link rel="prefetch" href="/assets/js/85.17637cbd.js"><link rel="prefetch" href="/assets/js/86.b002b254.js"><link rel="prefetch" href="/assets/js/87.4003e78e.js"><link rel="prefetch" href="/assets/js/88.6b6bbb09.js"><link rel="prefetch" href="/assets/js/89.07534671.js"><link rel="prefetch" href="/assets/js/9.49171bd8.js"><link rel="prefetch" href="/assets/js/90.c06565dd.js"><link rel="prefetch" href="/assets/js/91.f9349060.js"><link rel="prefetch" href="/assets/js/92.c004ed8a.js"><link rel="prefetch" href="/assets/js/93.44576857.js"><link rel="prefetch" href="/assets/js/94.6fd51387.js"><link rel="prefetch" href="/assets/js/95.31c497cb.js"><link rel="prefetch" href="/assets/js/96.d86aeac6.js"><link rel="prefetch" href="/assets/js/97.0c191837.js"><link rel="prefetch" href="/assets/js/98.64bfa3dd.js"><link rel="prefetch" href="/assets/js/99.aa18ad2d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a5d82ac5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d7f2299.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/btcpay-logo.svg" alt="BTCPay Server" class="logo"> <span class="site-name can-hide">BTCPay Server</span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/Deployment/" class="nav-link router-link-active">
  Deployment
</a></div><div class="nav-item"><a href="/Development/" class="nav-link">
  Developers
</a></div><div class="nav-item"><a href="/Contribute/" class="nav-link">
  Contribute
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide social"><div class="nav-item"><a href="https://btcpayserver.org/" target="_blank" rel="noopener noreferrer website" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.btcpayserver.org/" target="_blank" rel="noopener noreferrer chat" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/btcpayserver/" target="_blank" rel="noopener noreferrer github" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/BtcpayServer" target="_blank" rel="noopener noreferrer twitter" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <button type="button" class="btcpay-theme-switch"><svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path transform="translate(1 1)" d="M2.72 0A3.988 3.988 0 000 3.78c0 2.21 1.79 4 4 4 1.76 0 3.25-1.14 3.78-2.72-.4.13-.83.22-1.28.22-2.21 0-4-1.79-4-4 0-.45.08-.88.22-1.28z" class="btcpay-theme-switch-dark"></path><path transform="translate(1 1)" d="M4 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5S4.28 0 4 0zM1.5 1c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm5 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM4 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM.5 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM1.5 6c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm5 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM4 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5S4.28 7 4 7z" class="btcpay-theme-switch-light"></path></svg></button></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links social"><div class="nav-item"><a href="https://btcpayserver.org/" target="_blank" rel="noopener noreferrer website" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.btcpayserver.org/" target="_blank" rel="noopener noreferrer chat" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/btcpayserver/" target="_blank" rel="noopener noreferrer github" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/BtcpayServer" target="_blank" rel="noopener noreferrer twitter" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/Deployment/" class="nav-link router-link-active">
  Deployment
</a></div><div class="nav-item"><a href="/Development/" class="nav-link">
  Developers
</a></div><div class="nav-item"><a href="/Contribute/" class="nav-link">
  Contribute
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Deployment/" aria-current="page" class="sidebar-link">Choosing a Deployment Method</a></li><li><a href="/Deployment/ThirdPartyHosting/" class="sidebar-link">Third-party hosting</a></li><li><a href="/Configurator/" class="sidebar-link">Deploy BTCPay with Configurator</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Docker/" class="sidebar-link">Introduction</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/Deployment/webdeployment" class="sidebar-heading clickable"><span>Web/Cloud Deployment</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Deployment/LunaNode/" class="sidebar-link">Luna Node</a></li><li><a href="/Deployment/voltagecloud/" class="sidebar-link">Voltage Cloud</a></li><li><a href="/Deployment/Clovyr/" class="sidebar-link">Clovyr</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/Deployment/Azure" class="sidebar-heading clickable"><span>Azure</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/Deployment/GoogleCloud/" class="sidebar-link">Google Cloud</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/Deployment/Hardware" class="sidebar-heading clickable open"><span>Hardware Deployment</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/Deployment/RaspberryPi4/" class="sidebar-link">Raspberry Pi Deployment</a></li><li><a href="/Deployment/Hack0/" class="sidebar-link">Hack0 Deployment</a></li><li><a href="/Deployment/LightningInABox/" class="sidebar-link">LightningInABox Deployment</a></li><li><a href="/Deployment/DynamicDNS/" class="sidebar-link">Dynamic DNS</a></li><li><a href="/Docker/cloudflare-tunnel/" class="sidebar-link">Exposing on clearnet with Cloudflare</a></li><li><a href="/Deployment/ReverseSSHtunnel/" class="sidebar-link">Exposing on clearnet with a reverse SSH Tunnel</a></li><li><a href="/Deployment/ReverseProxyToTor/" aria-current="page" class="active sidebar-link">Exposing on Tor</a></li><li><a href="/Deployment/HardwareAsAService/" class="sidebar-link">Hardware As A Service</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Docker Plugins</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/Docker/fastsync/" class="sidebar-link">FastSync</a></li><li><a href="/Docker/backup-restore/" class="sidebar-link">Backup &amp; Restore</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Manual Deployment</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Deployment/ManualDeployment/" class="sidebar-link">Minimal manual setup</a></li><li><a href="/Deployment/ManualDeploymentExtended/" class="sidebar-link">Extended Manual Setup</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="reverse-proxy-to-tor"><a href="#reverse-proxy-to-tor" class="header-anchor">#</a> Reverse proxy to Tor</h1> <h2 id="advantages"><a href="#advantages" class="header-anchor">#</a> Advantages</h2> <ul><li>no port forwarding needed on the LAN of the host</li> <li>encrypted connection</li> <li>hides the IP of the host</li></ul> <h2 id="requirements"><a href="#requirements" class="header-anchor">#</a> Requirements</h2> <ul><li>a Virtual Private Server (VPS) - eg. a minimal package on Lunanode for ~3.5$/month</li> <li>root access on the VPS - you need to set up webserver and install packages</li> <li>a domain or subdomain - this will be setup on the proxy webserver</li></ul> <p>Get the Tor <code>.onion</code> address of your BTCPay Server via the <code>Server settings &gt; Services</code> page.
See information in the &quot;HTTP-based TOR hidden services&quot; section.</p> <p>Note: There is also a <a href="#do-all-this-in-a-docker-container">Docker version</a> of this setup.</p> <h2 id="vps-setup"><a href="#vps-setup" class="header-anchor">#</a> VPS Setup</h2> <p>You will create a nginx reverse proxy and a <code>socat</code> service, which forwards requests to your BTCPay Server.</p> <p>Login as root and install the required dependencies: (example assumes a Debian based system)</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># switch to root user (if not logged in as root)</span>
<span class="token function">sudo</span> <span class="token function">su</span> -

<span class="token comment"># install dependencies</span>
<span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> certbot nginx socat tor
</code></pre></div><h3 id="socat-setup"><a href="#socat-setup" class="header-anchor">#</a> Socat setup</h3> <p>Create the service file <code>/etc/systemd/system/http-to-socks-proxy@.service</code>:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">HTTP-to-SOCKS proxy</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">EnvironmentFile</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/http-to-socks-proxy/%i.conf</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/bin/socat tcp4-LISTEN:${LOCAL_PORT},reuseaddr,fork,keepalive,bind=127.0.0.1 SOCKS4A:${PROXY_HOST}:${REMOTE_HOST}:${REMOTE_PORT},socksport=${PROXY_PORT}</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span>
</code></pre></div><p>Create the configuration for the service in <code>/etc/http-to-socks-proxy/btcpayserver.conf</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># create the directory</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/http-to-socks-proxy/

<span class="token comment"># create the file with the content below</span>
<span class="token function">nano</span> /etc/http-to-socks-proxy/btcpayserver.conf
</code></pre></div><p>Replace the <code>REMOTE_HOST</code> and adapt the ports if needed:</p> <div class="language-conf extra-class"><pre class="language-text"><code>PROXY_HOST=127.0.0.1
PROXY_PORT=9050
LOCAL_PORT=9081
REMOTE_HOST=heregoesthebtcpayserverhiddenserviceaddress.onion
REMOTE_PORT=80
</code></pre></div><p>Create a symlink in <code>/etc/systemd/system/multi-user.target.wants</code> to enable the service and start it:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># enable</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/systemd/system/http-to-socks-proxy<span class="token punctuation">\</span>@.service /etc/systemd/system/multi-user.target.wants/http-to-socks-proxy<span class="token punctuation">\</span>@btcpayserver.service

<span class="token comment"># start</span>
systemctl start http-to-socks-proxy@btcpayserver

<span class="token comment"># check service status</span>
systemctl status http-to-socks-proxy@btcpayserver

<span class="token comment"># check if tunnel is active</span>
<span class="token function">netstat</span> <span class="token parameter variable">-tulpn</span> <span class="token operator">|</span> <span class="token function">grep</span> socat
<span class="token comment"># should give something like this:</span>
<span class="token comment"># tcp        0      0 127.0.0.1:9081          0.0.0.0:*               LISTEN      951/socat</span>
</code></pre></div><h3 id="webserver-setup"><a href="#webserver-setup" class="header-anchor">#</a> Webserver setup</h3> <h4 id="point-domain-to-the-vps"><a href="#point-domain-to-the-vps" class="header-anchor">#</a> Point domain to the VPS</h4> <p>Create the A record on the DNS server of your domain/subdomain and point it to your VPS IP address.</p> <h4 id="prepare-ssl-and-lets-encrypt"><a href="#prepare-ssl-and-lets-encrypt" class="header-anchor">#</a> Prepare SSL and Let's Encrypt</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># generate 4096 bit DH params to strengthen the security, may take a while</span>
openssl dhparam <span class="token parameter variable">-out</span> /etc/ssl/certs/dhparam.pem <span class="token number">4096</span>

<span class="token comment"># create directory for Let's Encrypt files</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/letsencrypt/.well-known
<span class="token function">chgrp</span> www-data /var/lib/letsencrypt
<span class="token function">chmod</span> g+s /var/lib/letsencrypt
</code></pre></div><h4 id="nginx-configuration-http"><a href="#nginx-configuration-http" class="header-anchor">#</a> nginx configuration: http</h4> <p>Create a variable mapping to forward the correct protocol setting and check if the Upgrade header is sent by the client, e.g. <code>/etc/nginx/conf.d/map.conf</code>:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">map</span> <span class="token variable">$http_x_forwarded_proto</span> <span class="token variable">$proxy_x_forwarded_proto</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">default</span> <span class="token variable">$http_x_forwarded_proto</span></span><span class="token punctuation">;</span>
  ''      $scheme<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">map</span> <span class="token variable">$http_upgrade</span> <span class="token variable">$connection_upgrade</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">default</span> upgrade</span><span class="token punctuation">;</span>
  ''      <span class="token directive"><span class="token keyword">close</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Create a config file for the domain, e.g. <code>/etc/nginx/sites-available/btcpayserver.conf</code>:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> btcpayserver.mydomain.com</span><span class="token punctuation">;</span>

  <span class="token comment"># Let's Encrypt verification requests</span>
  <span class="token directive"><span class="token keyword">location</span> ^~ /.well-known/acme-challenge/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span> /var/lib/letsencrypt/</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> <span class="token string">&quot;text/plain&quot;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> =404</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment"># Redirect everything else to https</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We will configure the https server part in the same config file once we obtained the SSL certificate.</p> <p>Enable the web server config by creating a symlink and restarting nginx:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/nginx/sites-available/btcpayserver.conf /etc/nginx/sites-enabled/btcpayserver.conf

systemctl restart nginx
</code></pre></div><h4 id="obtain-ssl-certificate-via-lets-encrypt"><a href="#obtain-ssl-certificate-via-lets-encrypt" class="header-anchor">#</a> Obtain SSL certificate via Let's Encrypt</h4> <p>Run the following command with adapted email and domain parameters:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>certbot certonly --agree-tos <span class="token parameter variable">--email</span> admin@mydomain.com <span class="token parameter variable">--webroot</span> <span class="token parameter variable">-w</span> /var/lib/letsencrypt/ <span class="token parameter variable">-d</span> btcpayserver.mydomain.com
</code></pre></div><h4 id="nginx-configuration-https"><a href="#nginx-configuration-https" class="header-anchor">#</a> nginx configuration: https</h4> <p>Now that we have a valid SSL certificate, add the https server part at the end of <code>/etc/nginx/sites-available/btcpayserver.conf</code>:</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> btcpayserver.mydomain.com</span><span class="token punctuation">;</span>

  <span class="token comment"># SSL settings</span>
  <span class="token directive"><span class="token keyword">ssl_stapling</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_stapling_verify</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">1d</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:10m</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_session_tickets</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>

  <span class="token comment"># Update this with the path of your certificate files</span>
  <span class="token directive"><span class="token keyword">ssl_certificate</span> /etc/letsencrypt/live/btcpayserver.mydomain.com/fullchain.pem</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /etc/letsencrypt/live/btcpayserver.mydomain.com/privkey.pem</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">ssl_dhparam</span> /etc/ssl/certs/dhparam.pem</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1.2 TLSv1.3</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_ciphers</span> ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">resolver</span> 8.8.8.8 8.8.4.4 valid=300s</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">resolver_timeout</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">add_header</span> Strict-Transport-Security <span class="token string">&quot;max-age=63072000&quot;</span> always</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> Content-Security-Policy <span class="token string">&quot;frame-ancestors 'self';&quot;</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> X-Content-Type-Options nosniff</span><span class="token punctuation">;</span>

  <span class="token comment"># Proxy requests to the socat service</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:9081/</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$proxy_x_forwarded_proto</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$connection_upgrade</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Restart nginx once more:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl restart nginx
</code></pre></div><p>Now, visiting <code>btcpayserver.mydomain.com</code> should show your BTCPay Server instance.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you see an nginx error of &quot;503 Service Temporarily Unavailable&quot; or similar but your BTCPay Server is reachable otherwise, you need to make BTCPay Server aware of your new domain. You can do so by using environment variables (Docker based setup), log into your BTCPay Server via SSH:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">su</span> -
<span class="token builtin class-name">cd</span> <span class="token variable">$BTCPAY_BASE_DIRECTORY</span>/btcpayserver-docker/
<span class="token builtin class-name">export</span> <span class="token assign-left variable">BTCPAY_ADDITIONAL_HOSTS</span><span class="token operator">=</span><span class="token string">&quot;btcpayserver.mydomain.com&quot;</span>
<span class="token builtin class-name">.</span> ./btcpay-setup.sh <span class="token parameter variable">-i</span>
</code></pre></div></div> <h2 id="do-all-this-in-a-docker-container"><a href="#do-all-this-in-a-docker-container" class="header-anchor">#</a> Do all this in a Docker container</h2> <p>Ready made <a href="https://hub.docker.com/r/cloudgenius/socator" target="_blank" rel="noopener noreferrer">Docker image<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (<a href="https://github.com/beacloudgenius/socator" target="_blank" rel="noopener noreferrer">Code<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <h3 id="socator-socat-tor"><a href="#socator-socat-tor" class="header-anchor">#</a> SocaTor = SOCAT + TOR</h3> <p>Based on <a href="https://github.com/Arno0x/Docker-Socator" target="_blank" rel="noopener noreferrer">Docker-Socator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>It uses socat to listen on a given TCP port (5000 in this example) and to redirect incoming traffic to a Tor hidden service specified through environment variables.
It acts as a relay between the standard web and a hidden service on the Tor network.
You can optionally restrict the IP addresses that are allowed to connect to this service by specifying an <code>ALLOWED_RANGE</code> environment variable and using CIDR notation.</p> <p>Please note:</p> <p>This container does not have any nginx component because Kubernetes provides for it.</p> <h3 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h3> <p>Break free from cloud services providers limitations, secure and protect your bitcoin full node, connect that with a BTC Pay server, all behind TOR.
Selectively expose the BTCPay Server payment gateway and API to clearnet using socat+tor running on the Internet.</p> <hr> <h4 id="build"><a href="#build" class="header-anchor">#</a> Build</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> build <span class="token parameter variable">-t</span> cloudgenius/socator <span class="token builtin class-name">.</span>
</code></pre></div><h4 id="push"><a href="#push" class="header-anchor">#</a> Push</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> push cloudgenius/socator
</code></pre></div><h4 id="start-the-image-in-background-daemon-mode-with-ip-address-restriction"><a href="#start-the-image-in-background-daemon-mode-with-ip-address-restriction" class="header-anchor">#</a> Start the image in background (<em>daemon mode</em>) with IP address restriction</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token punctuation">\</span>
        <span class="token parameter variable">-e</span> <span class="token string">&quot;ALLOWED_RANGE=192.168.1.0/24&quot;</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-e</span> <span class="token string">&quot;TOR_SITE=zqktlwiuavvvqqt4ybvgvi7tyo4hjl5xgfuvpdf6otjiycgwqbym2qad.onion&quot;</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-e</span> <span class="token string">&quot;TOR_SITE_PORT=80&quot;</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--name</span> socator <span class="token punctuation">\</span>
        cloudgenius/socator
</code></pre></div><h4 id="start-the-image-in-foreground"><a href="#start-the-image-in-foreground" class="header-anchor">#</a> Start the image in foreground</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">-ti</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-p</span> <span class="token number">5000</span>:5000 <span class="token punctuation">\</span>
        <span class="token parameter variable">-e</span> <span class="token string">&quot;TOR_SITE=zqktlwiuavvvqqt4ybvgvi7tyo4hjl5xgfuvpdf6otjiycgwqbym2qad.onion&quot;</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">-e</span> <span class="token string">&quot;TOR_SITE_PORT=80&quot;</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--name</span> socator <span class="token punctuation">\</span>
        cloudgenius/socator
</code></pre></div><p>Now <code>http://localhost:5000</code> should show you the tor hidden service you specified in the above command.</p> <h2 id="use-that-docker-container-in-a-kubernetes-cluster-using-these-manifests"><a href="#use-that-docker-container-in-a-kubernetes-cluster-using-these-manifests" class="header-anchor">#</a> Use that Docker container in a Kubernetes Cluster using these manifests</h2> <p>These manifest assumes a typical Kubernetes cluster that exposes internal services (like socator running internallly at port 5000) to the clearnet/public internet via <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener noreferrer">Nginx Ingress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and provide automated Let's Encrypt TLS/SSL certificates via <a href="https://github.com/jetstack/cert-manager" target="_blank" rel="noopener noreferrer">cert-manager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Deployment manifest</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> socator
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">role</span><span class="token punctuation">:</span> socator
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">role</span><span class="token punctuation">:</span> socator
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> cloudgenius/socator <span class="token comment"># code https://github.com/beacloudgenius/socator</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
          <span class="token key atrule">name</span><span class="token punctuation">:</span> socator
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TOR_SITE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'zqktlwiuavvvqqt4ybvgvi7tyo4hjl5xgfuvpdf6otjiycgwqbym2qad.onion'</span> <span class="token comment"># BTCPay Server Tor address =&gt; docker exec tor cat /var/lib/tor/app-btcpay-server/hostname</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> TOR_SITE_PORT
              <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">'80'</span>
</code></pre></div><p>Service manifest</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> socator
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5000</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">role</span><span class="token punctuation">:</span> socator
</code></pre></div><p>Ingress manifest</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> socator
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/ingress.class</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">cert-manager.io/cluster-issuer</span><span class="token punctuation">:</span> letsencrypt<span class="token punctuation">-</span>prod
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> btcpayserver.mydomain.com
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">service</span><span class="token punctuation">:</span>
                <span class="token key atrule">name</span><span class="token punctuation">:</span> socator
                <span class="token key atrule">port</span><span class="token punctuation">:</span>
                  <span class="token key atrule">number</span><span class="token punctuation">:</span> <span class="token number">5000</span>
            <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">pathType</span><span class="token punctuation">:</span> Prefix
  <span class="token key atrule">tls</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> btcpayserver.mydomain.com
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> socator<span class="token punctuation">-</span>tls
</code></pre></div><h2 id="resources"><a href="#resources" class="header-anchor">#</a> Resources</h2> <ul><li><a href="https://itgala.xyz/nginx-reverse-proxy-to-onion-site-in-tor-network/" target="_blank" rel="noopener noreferrer">nginx reverse proxy to .onion site in Tor network<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/openoms/bitcoin-tutorials/blob/master/tor2ip_tunnel.md" target="_blank" rel="noopener noreferrer">Tor-to-IP tunnel service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://stackoverflow.com/questions/55487324/how-to-make-a-nginx-reverse-proxy-direct-to-tor-hidden-service" target="_blank" rel="noopener noreferrer">How to make a nginx reverse proxy direct to tor hidden service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://linuxize.com/post/secure-nginx-with-let-s-encrypt-on-debian-10/" target="_blank" rel="noopener noreferrer">Secure Nginx with Let's Encrypt on Debian 10 Linux<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://nginx.org/en/docs/http/websocket.html" target="_blank" rel="noopener noreferrer">Nginx WebSocket proxying<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/btcpayserver/btcpayserver-doc/edit/master/docs/Deployment/ReverseProxyToTor.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="edit-link"><a href="https://github.com/btcpayserver/btcpayserver-doc/issues/new?title=Improve%20Reverse%20proxy%20to%20Tor&amp;body=I%20could%20not%20find%20the%20information%20I%20was%20looking%20for%20on%20the%20%22Reverse%20proxy%20to%20Tor%22%20page%20(%60%2FDeployment%2FReverseProxyToTor%2F%60).%0A%0A%5BPLEASE%20DESCRIBE%20HOW%20THE%20PAGE%20CAN%20BE%20IMPROVED%5D&amp;labels=question" target="_blank" rel="noopener noreferrer">Didn't find an answer?</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Deployment/ReverseSSHtunnel/" class="prev">
        Exposing on clearnet with a reverse SSH Tunnel
      </a></span> <span class="next"><a href="/Deployment/HardwareAsAService/">
        Hardware As A Service
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a6efeb8d.js" defer></script><script src="/assets/js/2.3670bf66.js" defer></script><script src="/assets/js/117.9bad4e6d.js" defer></script>
  </body>
</html>
