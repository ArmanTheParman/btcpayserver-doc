<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>eCommerce Integration Guide | BTCPay Server</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="stylesheet" href="/styles/btcpayserver-variables.css">
    <meta name="description" content="BTCPay Server Official Documentation">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    
    <link rel="preload" href="/assets/css/0.styles.5d7f2299.css" as="style"><link rel="preload" href="/assets/js/app.a6efeb8d.js" as="script"><link rel="preload" href="/assets/js/2.3670bf66.js" as="script"><link rel="preload" href="/assets/js/69.210cc955.js" as="script"><link rel="prefetch" href="/assets/js/1.4ae02fbc.js"><link rel="prefetch" href="/assets/js/100.a6a090d0.js"><link rel="prefetch" href="/assets/js/101.48d7fe0b.js"><link rel="prefetch" href="/assets/js/102.edbc4b40.js"><link rel="prefetch" href="/assets/js/103.df3cec0e.js"><link rel="prefetch" href="/assets/js/104.3af12b1c.js"><link rel="prefetch" href="/assets/js/105.67c00517.js"><link rel="prefetch" href="/assets/js/106.2e3b7c36.js"><link rel="prefetch" href="/assets/js/107.baf210cb.js"><link rel="prefetch" href="/assets/js/108.2fb98786.js"><link rel="prefetch" href="/assets/js/109.cd4733ca.js"><link rel="prefetch" href="/assets/js/110.08e4d8ee.js"><link rel="prefetch" href="/assets/js/111.a2bd256a.js"><link rel="prefetch" href="/assets/js/112.4cb55ab9.js"><link rel="prefetch" href="/assets/js/113.94f4ea42.js"><link rel="prefetch" href="/assets/js/114.72397f05.js"><link rel="prefetch" href="/assets/js/115.2c11a7c2.js"><link rel="prefetch" href="/assets/js/116.e7717439.js"><link rel="prefetch" href="/assets/js/117.9bad4e6d.js"><link rel="prefetch" href="/assets/js/118.965b0f5b.js"><link rel="prefetch" href="/assets/js/119.85a10df3.js"><link rel="prefetch" href="/assets/js/12.c2af5bc8.js"><link rel="prefetch" href="/assets/js/120.bab4f8cf.js"><link rel="prefetch" href="/assets/js/121.39edde96.js"><link rel="prefetch" href="/assets/js/122.bc507f9f.js"><link rel="prefetch" href="/assets/js/123.65ed732d.js"><link rel="prefetch" href="/assets/js/124.f07d4ef8.js"><link rel="prefetch" href="/assets/js/125.1f57aba4.js"><link rel="prefetch" href="/assets/js/126.7cb0c5eb.js"><link rel="prefetch" href="/assets/js/127.9fdfb987.js"><link rel="prefetch" href="/assets/js/128.2ed7dcb5.js"><link rel="prefetch" href="/assets/js/129.385cc686.js"><link rel="prefetch" href="/assets/js/13.96cec31e.js"><link rel="prefetch" href="/assets/js/130.5151da8c.js"><link rel="prefetch" href="/assets/js/131.a72975c2.js"><link rel="prefetch" href="/assets/js/132.6bd04635.js"><link rel="prefetch" href="/assets/js/133.664fab5f.js"><link rel="prefetch" href="/assets/js/134.1cbca681.js"><link rel="prefetch" href="/assets/js/135.11326201.js"><link rel="prefetch" href="/assets/js/136.674a7c3b.js"><link rel="prefetch" href="/assets/js/137.9e2b0bd2.js"><link rel="prefetch" href="/assets/js/138.e68e8975.js"><link rel="prefetch" href="/assets/js/139.b17a1bda.js"><link rel="prefetch" href="/assets/js/14.3a41f965.js"><link rel="prefetch" href="/assets/js/140.43e0ada0.js"><link rel="prefetch" href="/assets/js/141.4f4f0efd.js"><link rel="prefetch" href="/assets/js/142.d5397f55.js"><link rel="prefetch" href="/assets/js/143.3f0a3daf.js"><link rel="prefetch" href="/assets/js/144.3d80220b.js"><link rel="prefetch" href="/assets/js/145.efd552dd.js"><link rel="prefetch" href="/assets/js/146.6dcd1f30.js"><link rel="prefetch" href="/assets/js/147.7a62269f.js"><link rel="prefetch" href="/assets/js/148.0e73ab62.js"><link rel="prefetch" href="/assets/js/149.f2c369c9.js"><link rel="prefetch" href="/assets/js/15.455b42b1.js"><link rel="prefetch" href="/assets/js/150.4743378c.js"><link rel="prefetch" href="/assets/js/151.3e57b0d7.js"><link rel="prefetch" href="/assets/js/152.dc85d266.js"><link rel="prefetch" href="/assets/js/153.9cf476c2.js"><link rel="prefetch" href="/assets/js/154.5c479d69.js"><link rel="prefetch" href="/assets/js/155.3f76610d.js"><link rel="prefetch" href="/assets/js/156.0215db3a.js"><link rel="prefetch" href="/assets/js/157.969dc59e.js"><link rel="prefetch" href="/assets/js/158.53efbfce.js"><link rel="prefetch" href="/assets/js/159.e748b753.js"><link rel="prefetch" href="/assets/js/16.f4562109.js"><link rel="prefetch" href="/assets/js/160.3f8e5cf5.js"><link rel="prefetch" href="/assets/js/161.683f44cc.js"><link rel="prefetch" href="/assets/js/162.fd8d8f8b.js"><link rel="prefetch" href="/assets/js/163.7a156b64.js"><link rel="prefetch" href="/assets/js/164.51da5545.js"><link rel="prefetch" href="/assets/js/165.f97ba9fe.js"><link rel="prefetch" href="/assets/js/166.bac6f43d.js"><link rel="prefetch" href="/assets/js/167.1788725b.js"><link rel="prefetch" href="/assets/js/168.cf399eba.js"><link rel="prefetch" href="/assets/js/169.24fbe700.js"><link rel="prefetch" href="/assets/js/17.b1ac8a76.js"><link rel="prefetch" href="/assets/js/18.be0d72e4.js"><link rel="prefetch" href="/assets/js/19.e75652bc.js"><link rel="prefetch" href="/assets/js/20.11ba0743.js"><link rel="prefetch" href="/assets/js/21.729cf125.js"><link rel="prefetch" href="/assets/js/22.f0990b01.js"><link rel="prefetch" href="/assets/js/23.701eb6bf.js"><link rel="prefetch" href="/assets/js/24.e6f7096c.js"><link rel="prefetch" href="/assets/js/25.e5f66856.js"><link rel="prefetch" href="/assets/js/26.754ff1dd.js"><link rel="prefetch" href="/assets/js/27.0f9bb65c.js"><link rel="prefetch" href="/assets/js/28.8a6413ad.js"><link rel="prefetch" href="/assets/js/29.13f78c23.js"><link rel="prefetch" href="/assets/js/3.e7b96e02.js"><link rel="prefetch" href="/assets/js/30.83175d27.js"><link rel="prefetch" href="/assets/js/31.f5631287.js"><link rel="prefetch" href="/assets/js/32.85e70b21.js"><link rel="prefetch" href="/assets/js/33.fb7fc044.js"><link rel="prefetch" href="/assets/js/34.283f7600.js"><link rel="prefetch" href="/assets/js/35.c291d612.js"><link rel="prefetch" href="/assets/js/36.f3d7216d.js"><link rel="prefetch" href="/assets/js/37.b7e728eb.js"><link rel="prefetch" href="/assets/js/38.6cd70179.js"><link rel="prefetch" href="/assets/js/39.612d9495.js"><link rel="prefetch" href="/assets/js/4.ae9ec4e8.js"><link rel="prefetch" href="/assets/js/40.991f2124.js"><link rel="prefetch" href="/assets/js/41.b7651d8a.js"><link rel="prefetch" href="/assets/js/42.80411d32.js"><link rel="prefetch" href="/assets/js/43.1b59571d.js"><link rel="prefetch" href="/assets/js/44.dd2311c3.js"><link rel="prefetch" href="/assets/js/45.3c470392.js"><link rel="prefetch" href="/assets/js/46.be278dd6.js"><link rel="prefetch" href="/assets/js/47.2174348a.js"><link rel="prefetch" href="/assets/js/48.921df9ab.js"><link rel="prefetch" href="/assets/js/49.9e160e5a.js"><link rel="prefetch" href="/assets/js/5.ec07fb10.js"><link rel="prefetch" href="/assets/js/50.4e61de35.js"><link rel="prefetch" href="/assets/js/51.3e2277e7.js"><link rel="prefetch" href="/assets/js/52.b22b9e0c.js"><link rel="prefetch" href="/assets/js/53.f41a19b5.js"><link rel="prefetch" href="/assets/js/54.c7688166.js"><link rel="prefetch" href="/assets/js/55.4f63233f.js"><link rel="prefetch" href="/assets/js/56.2ef89fb5.js"><link rel="prefetch" href="/assets/js/57.51ae8c08.js"><link rel="prefetch" href="/assets/js/58.70bc2588.js"><link rel="prefetch" href="/assets/js/59.d4c3a24f.js"><link rel="prefetch" href="/assets/js/6.04bdb264.js"><link rel="prefetch" href="/assets/js/60.34732982.js"><link rel="prefetch" href="/assets/js/61.2f2a3d30.js"><link rel="prefetch" href="/assets/js/62.a0012c4f.js"><link rel="prefetch" href="/assets/js/63.a0c426d8.js"><link rel="prefetch" href="/assets/js/64.e6503d0d.js"><link rel="prefetch" href="/assets/js/65.fc7cb630.js"><link rel="prefetch" href="/assets/js/66.b8183b5f.js"><link rel="prefetch" href="/assets/js/67.8790a920.js"><link rel="prefetch" href="/assets/js/68.e2dc3e6e.js"><link rel="prefetch" href="/assets/js/7.16399f20.js"><link rel="prefetch" href="/assets/js/70.5a97b5b1.js"><link rel="prefetch" href="/assets/js/71.4c62d8f5.js"><link rel="prefetch" href="/assets/js/72.f20ef58d.js"><link rel="prefetch" href="/assets/js/73.9e00ec3f.js"><link rel="prefetch" href="/assets/js/74.55197e58.js"><link rel="prefetch" href="/assets/js/75.1f727dbd.js"><link rel="prefetch" href="/assets/js/76.a3429877.js"><link rel="prefetch" href="/assets/js/77.6b1d2bf6.js"><link rel="prefetch" href="/assets/js/78.2b569889.js"><link rel="prefetch" href="/assets/js/79.32e6d61c.js"><link rel="prefetch" href="/assets/js/8.ac3ed6a5.js"><link rel="prefetch" href="/assets/js/80.6b2f5411.js"><link rel="prefetch" href="/assets/js/81.f716757f.js"><link rel="prefetch" href="/assets/js/82.fe776dc9.js"><link rel="prefetch" href="/assets/js/83.0aa42b31.js"><link rel="prefetch" href="/assets/js/84.e047721d.js"><link rel="prefetch" href="/assets/js/85.17637cbd.js"><link rel="prefetch" href="/assets/js/86.b002b254.js"><link rel="prefetch" href="/assets/js/87.4003e78e.js"><link rel="prefetch" href="/assets/js/88.6b6bbb09.js"><link rel="prefetch" href="/assets/js/89.07534671.js"><link rel="prefetch" href="/assets/js/9.49171bd8.js"><link rel="prefetch" href="/assets/js/90.c06565dd.js"><link rel="prefetch" href="/assets/js/91.f9349060.js"><link rel="prefetch" href="/assets/js/92.c004ed8a.js"><link rel="prefetch" href="/assets/js/93.44576857.js"><link rel="prefetch" href="/assets/js/94.6fd51387.js"><link rel="prefetch" href="/assets/js/95.31c497cb.js"><link rel="prefetch" href="/assets/js/96.d86aeac6.js"><link rel="prefetch" href="/assets/js/97.0c191837.js"><link rel="prefetch" href="/assets/js/98.64bfa3dd.js"><link rel="prefetch" href="/assets/js/99.aa18ad2d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.a5d82ac5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d7f2299.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/btcpay-logo.svg" alt="BTCPay Server" class="logo"> <span class="site-name can-hide">BTCPay Server</span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/Deployment/" class="nav-link">
  Deployment
</a></div><div class="nav-item"><a href="/Development/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="/Contribute/" class="nav-link">
  Contribute
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide social"><div class="nav-item"><a href="https://btcpayserver.org/" target="_blank" rel="noopener noreferrer website" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.btcpayserver.org/" target="_blank" rel="noopener noreferrer chat" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/btcpayserver/" target="_blank" rel="noopener noreferrer github" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/BtcpayServer" target="_blank" rel="noopener noreferrer twitter" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <button type="button" class="btcpay-theme-switch"><svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path transform="translate(1 1)" d="M2.72 0A3.988 3.988 0 000 3.78c0 2.21 1.79 4 4 4 1.76 0 3.25-1.14 3.78-2.72-.4.13-.83.22-1.28.22-2.21 0-4-1.79-4-4 0-.45.08-.88.22-1.28z" class="btcpay-theme-switch-dark"></path><path transform="translate(1 1)" d="M4 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5S4.28 0 4 0zM1.5 1c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm5 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM4 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM.5 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM1.5 6c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm5 0c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM4 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5S4.28 7 4 7z" class="btcpay-theme-switch-light"></path></svg></button></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links social"><div class="nav-item"><a href="https://btcpayserver.org/" target="_blank" rel="noopener noreferrer website" class="nav-link external">
  Website
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.btcpayserver.org/" target="_blank" rel="noopener noreferrer chat" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/btcpayserver/" target="_blank" rel="noopener noreferrer github" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://twitter.com/BtcpayServer" target="_blank" rel="noopener noreferrer twitter" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <nav class="nav-links"><div class="nav-item"><a href="/Guide/" class="nav-link">
  User Guide
</a></div><div class="nav-item"><a href="/Deployment/" class="nav-link">
  Deployment
</a></div><div class="nav-item"><a href="/Development/" class="nav-link router-link-active">
  Developers
</a></div><div class="nav-item"><a href="/Contribute/" class="nav-link">
  Contribute
</a></div><div class="nav-item"><a href="/FAQ/" class="nav-link">
  FAQ
</a></div> <a href="https://github.com/btcpayserver/btcpayserver-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Greenfield API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://docs.btcpayserver.org/API/Greenfield/v1" target="_blank" rel="noopener noreferrer" class="sidebar-link">Greenfield API v1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/Development/ecommerce-integration-guide/" aria-current="page" class="active sidebar-link">eCommerce Integration Guide</a></li><li><a href="/BTCPayServer/greenfield-authorization/" class="sidebar-link">GreenField API Authorization Flow</a></li><li><a href="/Development/GreenFieldExample/" class="sidebar-link">Greenfield API example with cURL</a></li><li><a href="/Development/GreenFieldExample-NodeJS/" class="sidebar-link">Greenfield API example with Node.js (JavaScript)</a></li><li><a href="/Development/GreenfieldExample-PHP/" class="sidebar-link">Greenfield API examples with PHP</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Development</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Development/" aria-current="page" class="sidebar-link">Architecture</a></li><li><a href="/Development/LocalDevelopment/" class="sidebar-link">Local development</a></li><li><a href="/BTCPayServer/greenfield-development/" class="sidebar-link">Greenfield API Development</a></li><li><a href="/Development/Plugins/" class="sidebar-link">Plugins</a></li><li><a href="/Development/Altcoins/" class="sidebar-link">How to add an Altcoin</a></li><li><a href="/Development/InvoiceMetadata/" class="sidebar-link">Invoice metadata</a></li><li><a href="/Development/Theme/" class="sidebar-link">Customizing themes</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>NBXplorer</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NBXplorer/" class="sidebar-link">Overview</a></li><li><a href="/NBXplorer/API/" class="sidebar-link">API Specification</a></li><li><a href="/NBXplorer/Postgres-Schema/" class="sidebar-link">Postgres Schema</a></li><li><a href="/NBXplorer/Postgres-Migration/" class="sidebar-link">Postgres Migration</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>More</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/Vault/" class="sidebar-heading clickable"><span>BTCPay Server Vault</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/BTCPayServer/Security/" class="sidebar-link">Security Disclosures</a></li><li><a href="/Development/TestnetDemo/" class="sidebar-link">Testnet deployment</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ecommerce-integration-guide"><a href="#ecommerce-integration-guide" class="header-anchor">#</a> eCommerce Integration Guide</h1> <p>This document aims to give best practices and a guide on how to integrate BTCPay Server as a payment solution into eCommerce, ERP, Point of Sale or other systems. If you want to do a broader integration which also manages stores and users on BTCPay this guide is still useful as a starting point. You can find examples on how to manage your BTCPay Server headless via <a href="/Development/GreenFieldExample/">cURL</a>, <a href="/Development/GreenFieldExample-NodeJS/">Node.js</a> or <a href="/Development/GreenfieldExample-PHP/">PHP</a> in our docs.</p> <h2 id="table-of-contents"><a href="#table-of-contents" class="header-anchor">#</a> Table of contents</h2> <p></p><div class="table-of-contents"><ul><li><a href="#table-of-contents">Table of contents</a></li><li><a href="#general-information">General information</a></li><li><a href="#greenfield-api-docs">Greenfield API docs</a></li><li><a href="#authentication">Authentication</a><ul><li><a href="#api-keys">API Keys</a></li><li><a href="#permissions">Permissions</a></li></ul></li><li><a href="#setup-best-practices">Setup best practices</a><ul><li><a href="#automatic-setup">Automatic setup</a></li><li><a href="#manual-setup">Manual setup</a></li></ul></li><li><a href="#checkout-flow">Checkout flow</a><ul><li><a href="#overview-of-the-checkout-flow">Overview of the checkout flow</a></li><li><a href="#showing-btcpay-bitcoin-lightning-network-as-payment-gateway">Showing BTCPay (Bitcoin / Lightning Network) as payment gateway</a></li><li><a href="#creating-an-invoice">Creating an invoice</a></li><li><a href="#redirect">Redirect</a></li><li><a href="#modal-invoice-page-advanced-optional">Modal invoice page (advanced, optional)</a></li><li><a href="#validate-and-process-webhooks">Validate and process webhooks</a></li><li><a href="#refunds">Refunds</a></li></ul></li><li><a href="#logging-debugging">Logging / Debugging</a></li><li><a href="#data-scarcity">Data scarcity</a></li></ul></div><p></p> <h2 id="general-information"><a href="#general-information" class="header-anchor">#</a> General information</h2> <p>The general idea is to have a smooth setup for your users and a seamless checkout experience for their customers. By providing an automated setup wizard as described below you can avoid writing lots of documentation and make the process as easy as possible for your users.</p> <h2 id="greenfield-api-docs"><a href="#greenfield-api-docs" class="header-anchor">#</a> Greenfield API docs</h2> <p>You can find the API documentation of our so-called Greenfield API <a href="https://docs.btcpayserver.org/API/Greenfield/v1/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (or on your BTCPay Server on the <code>/docs</code> path). As a quick starter, we have covered the most basic eCommerce integration endpoints examples for <a href="/Development/GreenFieldExample/">cURL</a>, <a href="/Development/GreenFieldExample-NodeJS/">Node.js</a> and <a href="/Development/GreenfieldExample-PHP/">PHP</a>. We will refer to those examples throughout this document.</p> <p>In the examples below we use the our demo server <a href="https://mainnet.demo.btcpayserver.org" target="_blank" rel="noopener noreferrer">https://mainnet.demo.btcpayserver.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as an example. On your integration, this will be the user provided BTCPay Server instance URL.</p> <h2 id="authentication"><a href="#authentication" class="header-anchor">#</a> Authentication</h2> <p>Authentication can be done over Basic-Auth or API key. Using Basic-Auth is not recommended as it will always have full access of your user. With API keys you can give fine-grained permissions per store that can’t do much damage even if your API key is leaked.</p> <p><strong>Important</strong>: the Authorization-Header is formatted like this:</p> <p><code>Authorization: token API_KEY</code>
(Replace API_KEY with the actual API key)</p> <p>Example using cURL:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">-H</span> <span class="token string">&quot;Authorization: token API_KEY&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">-X</span> GET <span class="token punctuation">\</span>
     <span class="token string">&quot;https://mainnet.demo.btcpayserver.org/api/v1/stores/STORE_ID&quot;</span>
</code></pre></div><h3 id="api-keys"><a href="#api-keys" class="header-anchor">#</a> API Keys</h3> <p>You can generate API keys via the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#tag/Authorization" target="_blank" rel="noopener noreferrer">authorization endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (as detailed below in <a href="#automatic-setup">automatic setup</a>) or for testing you can do so manually as described on <a href="#manual-setup">manual setup</a>.</p> <h3 id="permissions"><a href="#permissions" class="header-anchor">#</a> Permissions</h3> <p>You need the following permissions for a typical eCommerce integration and as a starting point to process payments and refunds:</p> <p><code>btcpay.store.canviewinvoices</code> <br> <code>btcpay.store.cancreateinvoice</code> <br> <code>btcpay.store.canmodifyinvoices</code> <br> <code>btcpay.store.webhooks.canmodifywebhooks</code> <br> <code>btcpay.store.canviewstoresettings</code> <br> <code>btcpay.store.cancreatenonapprovedpullpayments</code></p> <p>This allows you to have the minimal needed permissions to create invoices, refunds and to programmatically register a webhook. You should also limit your API key to a specific store, otherwise the API key will work for all the stores of a user.</p> <h2 id="setup-best-practices"><a href="#setup-best-practices" class="header-anchor">#</a> Setup best practices</h2> <h3 id="automatic-setup"><a href="#automatic-setup" class="header-anchor">#</a> Automatic setup</h3> <figure><img src="/assets/img/btcpay-authorize-app-api-key.7a407a00.png" alt="Authorize App, API key generation" title="Authorize App, API key generation"></figure> <p>To make the connection flow between your eCommerce system and BTCPay Server as smooth and easy as possible for your users, you can guide them through a setup wizard. This means that ideally the user only enters the URL to their BTCPay Server instance (e.g. <a href="https://mainnet.demo.btcpayserver.org" target="_blank" rel="noopener noreferrer">https://mainnet.demo.btcpayserver.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) and clicks on a &quot;<em>Connect BTCPay Server</em>&quot; button that will start the following process:</p> <ul><li>User will get redirected to BTCPay Server authorization page</li> <li>User logs in with their BTCPay Server account (if not already)</li> <li>User selects the desired store (if they have multiple stores)</li> <li>User can enter a label to identify the API key in their BTCPay Server account (optional)</li> <li>Required permissions (see above screenshot) are already pre-filled for the user</li> <li>When the user clicks &quot;Authorize app&quot; BTCPay will generate an API key with the permissions and bound to a single store and send it back to your eCommerce system</li> <li>There you can process the returned payload which contains the API key and the store id</li> <li>Using that API key you can register a webhook endpoint (of your eCommerce system) on the users store</li> <li>That endpoint will return a webhook &quot;secret&quot; that you need later to store and use to validate incoming webhook events on invoice status changes</li> <li>You store all those information in your eCommerce system and the setup is done</li></ul> <h4 id="example-of-request-of-authorization-endpoint"><a href="#example-of-request-of-authorization-endpoint" class="header-anchor">#</a> Example of request of <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/ApiKeys_Authorize" target="_blank" rel="noopener noreferrer">Authorization endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</h4> <p><strong>Important</strong>: &quot;selectiveStores&quot; needs to be set to true so the user has to explicitly select a store for which the API key will get permissions to. Otherwise the user can select multiple stores.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token punctuation">\</span>
      <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token punctuation">\</span>
      <span class="token parameter variable">-X</span> GET <span class="token punctuation">\</span>
      <span class="token string">&quot;https://mainnet.demo.btcpayserver.org/api-keys/authorize?permissions=btcpay.store.canviewinvoices&amp;permissions=btcpay.store.cancreateinvoice&amp;permissions=btcpay.store.canmodifyinvoices&amp;permissions=btcpay.store.webhooks.canmodifywebhooks&amp;permissions=btcpay.store.canviewstoresettings&amp;permissions=btcpay.store.cancreatenonapprovedpullpayments&amp;strict=true&amp;selectiveStores=true&amp;applicationName=YourAppName&amp;redirect=https://example.com/your-callback-url&quot;</span>
</code></pre></div><h3 id="manual-setup"><a href="#manual-setup" class="header-anchor">#</a> Manual setup</h3> <p>You or your user can also create API keys manually in the BTCPay Server UI. That said, the automatic setup is more user-friendly and less error-prone. The manual setup is done as follows:</p> <ul><li>User logs into BTCPay Server instance</li> <li>User clicks &quot;<em>Account</em>&quot; -&gt; &quot;<em>Manage Account</em>&quot; -&gt; &quot;<em>API keys</em>&quot;</li> <li>Creates an API key with above-mentioned permissions, limited to a specific store</li> <li>Copies the API key and store id to your form</li> <li>Creates a webhook in store: &quot;<em>Settings</em>&quot; -&gt; &quot;<em>Webhooks</em>&quot;; Copies the <code>secret</code> into your settings form</li></ul> <h2 id="checkout-flow"><a href="#checkout-flow" class="header-anchor">#</a> Checkout flow</h2> <h3 id="overview-of-the-checkout-flow"><a href="#overview-of-the-checkout-flow" class="header-anchor">#</a> Overview of the checkout flow</h3> <p><strong><em>Legend</em></strong>:</p> <p><strong>FE</strong>: Frontend (your website/existing system) <br> <strong>BE</strong>: Backend (your website/existing system) <br> <strong>BTCPay</strong>: BTCPay Server instance hosted by yourself or a 3rd party</p> <figure><img src="/assets/img/btcpay-checkout-flow-chart.1639f36e.png" alt="BTCPay checkout flow chart" title="BTCPay checkout flow chart"></figure> <ol><li>FE: On checkout the user selects payment method (in this case e.g. Bitcoin (via BTCPay))</li> <li>FE/BE: Checkout data is passed to BE and BE <a href="#creating-an-invoice">creates an invoice</a> on BTCPay, your BE stores the invoice ID alongside your internal order or checkout id so it can be matched at a later point.</li> <li>FE option 1: the customer gets redirected to BTCPay invoice page and sees the QR-code and payment options  <br>
FE option 2: the customer sees the BTCPay checkout page in an modal overlay</li> <li>Customer pays the invoice</li> <li>BTCPay: as soon as the payment is seen in the mempool (and the invoice is paid fully) BTCPay fires a webhook with the &quot;InvoiceProcessing&quot; event; BE needs to update the payment status to e.g. &quot;pending&quot;, &quot;approved&quot;, &quot;on-hold&quot;</li> <li>Customer gets redirected to order-confirmation page either automatically or by clicking a button</li> <li>BTCPay: depending on configured number of confirmations (defaults to 1 confirmation) BTCPay fires a webhook with the &quot;InvoiceSettled&quot; event; BE updates the order status to e.g. &quot;paid&quot;, &quot;settled&quot;</li></ol> <p>Note: the webhooks of 5. and 7. fire with an average 10 minute time gap, depending on when the next block is found for on-chain bitcoin transactions. For Lightning Network (off-chain) transactions those two events fire immediately after each other and the payment is settled.</p> <h3 id="showing-btcpay-bitcoin-lightning-network-as-payment-gateway"><a href="#showing-btcpay-bitcoin-lightning-network-as-payment-gateway" class="header-anchor">#</a> Showing BTCPay (Bitcoin / Lightning Network) as payment gateway</h3> <p>This is highly dependent on how your checkout flow works. On most eCommerce stores you have a payment step and on that step different payment methods are listed. Usually you list &quot;Bitcoin / Lightning Network&quot;. The default is that all configured payment methods on BTCPay Server side will be available on the invoice page where the QR-code is shown. For more advanced use-cases you could also list supported payment methods separately and pass them when creating the invoic, this way you could give e.g. discount on Lightning Network payments compared to on-chain payments.</p> <h3 id="creating-an-invoice"><a href="#creating-an-invoice" class="header-anchor">#</a> Creating an invoice</h3> <p>When the customer chooses BTCPay (Bitcoin / Lightning Network) as payment option on the FE your BE needs to create an invoice using the create invoice endpoint. This will return you an invoice object with an invoice ID, this invoice ID should be stored alongside your order as it will be used in webhooks so you can match and find your order. The returned invoice object also contains a property &quot;checkoutLink&quot; this is the link you can redirect your customer to pay, see below.</p> <p>This is done by using the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Invoices_CreateInvoice" target="_blank" rel="noopener noreferrer">create invoice endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, see examples in <a href="/Development/GreenFieldExample/#create-an-invoice">cURL</a>, <a href="/Development/GreenFieldExample-NodeJS/">Node.Js</a> or <a href="/Development/GreenfieldExample-PHP/#create-an-invoice">PHP</a>.</p> <p>It is important that you store the invoice id alongside your internal order or checkout object. This is needed so that you can find the matching internal order when you process the <a href="#invoice-webhook-events">webhook events</a>.</p> <h3 id="redirect"><a href="#redirect" class="header-anchor">#</a> Redirect</h3> <p>The invoice object contains the property <code>checkoutLink</code> which is the URL to your BTCPay checkout page for that specific invoice. You can redirect the customers to that page so they can pay.</p> <p>After successful payment the customer will get redirected back to your store or to the specified <code>redirectURL</code> in the <code>checkout</code> object, you can set that on creating the invoice.</p> <h3 id="modal-invoice-page-advanced-optional"><a href="#modal-invoice-page-advanced-optional" class="header-anchor">#</a> Modal invoice page (advanced, optional)</h3> <p>Instead of redirecting the customer to an external BTCPay invoice checkout page you can also show it via an modal/overlay directly on your store checkout. For this you need to load the <code>btcpay.js</code> from your BTCPay instance and add some Javascript to your frontend that listens on payment events.</p> <p>Load the <code>btcpay.js</code> script from your BTCPay instance:
<code>https://mainnet.demo.btcpayserver.org/modal/btcpay.js</code></p> <p>Below is a simplified example of how to listen to payment events. You can find a full example in our WooCommerce plugin <a href="https://github.com/btcpayserver/woocommerce-greenfield-plugin/blob/master/resources/js/frontend/modalCheckout.js" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> invoice_paid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>btcpay<span class="token punctuation">.</span><span class="token function">onModalReceiveMessage</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'complete'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'paid'</span><span class="token operator">:</span>
          invoice_paid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          window<span class="token punctuation">.</span>location <span class="token operator">=</span> data<span class="token punctuation">.</span>orderCompleteLink<span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'expired'</span><span class="token operator">:</span>
          window<span class="token punctuation">.</span>btcpay<span class="token punctuation">.</span><span class="token function">hideFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// Show some error to the user.</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// handle event.data &quot;loaded&quot; &quot;closed&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data <span class="token operator">===</span> <span class="token string">'close'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>invoice_paid <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>location <span class="token operator">=</span> data<span class="token punctuation">.</span>orderCompleteLink<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// Show some error to the user, user closed the modal by clicking the X.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">isObject</span> <span class="token operator">=</span> <span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="validate-and-process-webhooks"><a href="#validate-and-process-webhooks" class="header-anchor">#</a> Validate and process webhooks</h3> <h4 id="invoice-webhook-events"><a href="#invoice-webhook-events" class="header-anchor">#</a> Invoice webhook events</h4> <p>These invoice webhook events are available, for details click on the link to the API doc.</p> <ul><li><strong>InvoiceCreated</strong>: Invoice has been created</li> <li><strong>InvoiceReceivedPayment</strong>: Payment has been seen in the mempool (unconfirmed)</li> <li><strong>InvoicePaymentSettled</strong>: Payment has been confirmed on the blockchain</li> <li><strong>InvoiceProcessing</strong>: Full invoice payment ahs been seen in the mempool (unconfirmed), BE should update the order status to &quot;pending&quot; or &quot;approved&quot;</li> <li><strong>InvoiceExpired</strong>: Payment is not seen in the mempool within the time frame, BE should update the order status to &quot;expired&quot;</li> <li><strong>InvoiceSettled</strong>: Payment is confirmed on the blockchain, BE should update the order status to &quot;paid&quot; or &quot;settled&quot;</li> <li><strong>InvoiceInvalid</strong>: Payment is invalid, BE should update the order status to &quot;invalid&quot;</li></ul> <p>The most important events are:</p> <ul><li>InvoiceProcessing</li> <li>InvoiceExpired</li> <li>InvoiceSettled</li> <li>InvoiceInvalid</li></ul> <p>But you also need these events to e.g. handle payments after expiration:</p> <ul><li>InvoiceReceivedPayment</li> <li>InvoicePaymentSettled</li></ul> <h4 id="possible-invoices-states"><a href="#possible-invoices-states" class="header-anchor">#</a> Possible invoices states</h4> <p>Normally the webhook events are enough to set the order status in your BE and there is no need to do an additional GET request to check the status of the invoice. However sometimes you still need to do that and check what the actual status is. You can do that by using the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Invoices_GetInvoice" target="_blank" rel="noopener noreferrer">get invoice endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Like with the webhook events you need to be aware of edge-cases like partial or overpayment. On the returned invoice object you have two important properties that will give you a clear status of what the current satus of the invoice is:</p> <ul><li><strong>status</strong>: <code>Expired</code> <code>Invalid</code> <code>New</code> <code>Processing</code> <code>Settled</code></li> <li><strong>additionalStatus</strong>: <code>Invalid</code> <code>Marked</code> <code>None</code> <code>PaidLate</code> <code>PaidOver</code> <code>PaidPartial</code></li></ul> <p>You always need to check both properties to get the full picture of the invoice status. It could happen that an invoice is expired but it was paid partially or fully paid after the invoice expired.</p> <h4 id="validate-webhook-signature"><a href="#validate-webhook-signature" class="header-anchor">#</a> Validate webhook signature</h4> <p>When you receive a webhook event you should validate the signature to make sure the event is actually coming from your BTCPay Server instance. The signature is a HMAC-SHA256 hash of the event payload and your webhook secret. The secret is returned when you register a webhook on the store (as mentioned above). You can find the secret in the BTCPay Server UI under &quot;<em>Settings</em>&quot; -&gt; &quot;<em>Webhooks</em>&quot;.</p> <p>You can find examples for <a href="/Development/GreenFieldExample-NodeJS/#validate-and-process-webhooks">Node.Js</a> and <a href="/Development/GreenfieldExample-PHP/#validate-and-process-webhooks">PHP</a> in our docs.</p> <h4 id="process-webhook-events"><a href="#process-webhook-events" class="header-anchor">#</a> Process webhook events</h4> <p>Each webhook payload with have an <code>invoiceId</code> property, this is the id of the invoice that the event is related to. As you stored that invoice id alongside your order you can now find the matching order and update the status accordingly.</p> <p>In most cases you can ignore the <code>InvoiceCreated</code> event as you created the invoice during the checkout process and already have stored the invoice id alongside your order. But there are some edge-cases where you will have expired invoices that have been paid partially or overpaid. You can check our WooCommerce plugin PHP code for an example on how to handle those cases <a href="https://github.com/btcpayserver/woocommerce-greenfield-plugin/blob/master/src/Gateway/AbstractGateway.php#L504" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>On the invoice details page you can manually re-trigger the webhook events for testing purposes, by clicking on the &quot;Redeliver&quot; link on the list of webhooks.</p></div> <h3 id="refunds"><a href="#refunds" class="header-anchor">#</a> Refunds</h3> <p>Refunds can be issued via the <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/Invoices_Refund" target="_blank" rel="noopener noreferrer">invoice refund endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This will return a link where the customer can claim the refund. You can find examples for <a href="/Development/GreenFieldExample-NodeJS/#issue-a-full-refund-of-an-invoice">Node.Js</a> and <a href="/Development/GreenfieldExample-PHP/#issue-a-full-refund-of-an-invoice">PHP</a> in our docs.</p> <p>Alternatively you can also use the more generic <a href="https://docs.btcpayserver.org/API/Greenfield/v1/#operation/PullPayments_CreatePullPayment" target="_blank" rel="noopener noreferrer">pull-payments endpoint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="logging-debugging"><a href="#logging-debugging" class="header-anchor">#</a> Logging / Debugging</h2> <p>On every API call and internal interaction like status updates you should catch errors and log them accordingly. So that in your BE the users/admins can see what the problem is and reach out to you with the actual error. You avoid lots of back and forth this way. You can also consider to do a &quot;debug-mode&quot; which will log even more data like webhook payloads and internal status updates - to allow more fine-grained bug hunting.</p> <h2 id="data-scarcity"><a href="#data-scarcity" class="header-anchor">#</a> Data scarcity</h2> <p>While it is possible that you pass any data as metadata to an invoice, you should not send customer data unless you have good reasons to do so. The most important metadata you want to send is the <code>orderId</code> which you can use to then link with BTCPay <code>invoiceId</code>. This way there is no need to pass all customer data along and risk leaking the data if there is a hack of your BTCPay Server instance (or in case your users use a 3rd party host).</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/btcpayserver/btcpayserver-doc/edit/master/docs/Development/ecommerce-integration-guide.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="edit-link"><a href="https://github.com/btcpayserver/btcpayserver-doc/issues/new?title=Improve%20eCommerce%20Integration%20Guide&amp;body=I%20could%20not%20find%20the%20information%20I%20was%20looking%20for%20on%20the%20%22eCommerce%20Integration%20Guide%22%20page%20(%60%2FDevelopment%2Fecommerce-integration-guide%2F%60).%0A%0A%5BPLEASE%20DESCRIBE%20HOW%20THE%20PAGE%20CAN%20BE%20IMPROVED%5D&amp;labels=question" target="_blank" rel="noopener noreferrer">Didn't find an answer?</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="https://docs.btcpayserver.org/API/Greenfield/v1" target="_blank" rel="noopener noreferrer" class="prev">
        Greenfield API v1

        <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></span> <span class="next"><a href="/BTCPayServer/greenfield-authorization/">
        GreenField API Authorization Flow
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a6efeb8d.js" defer></script><script src="/assets/js/2.3670bf66.js" defer></script><script src="/assets/js/69.210cc955.js" defer></script>
  </body>
</html>
